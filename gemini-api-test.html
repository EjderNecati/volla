<!DOCTYPE html>
<html>
<head>
    <title>Gemini API Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        pre {
            background: #000;
            padding: 15px;
            border: 1px solid #0f0;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        input {
            width: 500px;
            padding: 8px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>üîç Gemini API Debug Tool</h1>
    
    <div>
        <label>API Key:</label><br>
        <input type="text" id="apiKey" placeholder="AIza..." value="">
    </div>
    
    <h2>Test 1: List Models (v1beta)</h2>
    <button onclick="listModels('v1beta')">List Models (v1beta)</button>
    <pre id="output1">Click button to test...</pre>
    
    <h2>Test 2: List Models (v1)</h2>
    <button onclick="listModels('v1')">List Models (v1)</button>
    <pre id="output2">Click button to test...</pre>
    
    <h2>Test 3: Try gemini-pro (v1)</h2>
    <button onclick="testModel('v1', 'gemini-pro')">Test gemini-pro</button>
    <pre id="output3">Click button to test...</pre>
    
    <h2>Test 4: Try gemini-1.5-flash-latest (v1beta)</h2>
    <button onclick="testModel('v1beta', 'gemini-1.5-flash-latest')">Test gemini-1.5-flash-latest</button>
    <pre id="output4">Click button to test...</pre>

    <script>
        // Try to load API key from localStorage
        const savedKey = localStorage.getItem('volla_api_key');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
        }

        async function listModels(version) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('Please enter API key');
                return;
            }
            
            const outputId = version === 'v1beta' ? 'output1' : 'output2';
            const output = document.getElementById(outputId);
            output.textContent = 'Loading...';
            
            try {
                const url = `https://generativelanguage.googleapis.com/${version}/models?key=${apiKey}`;
                console.log('Fetching:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (!response.ok) {
                    output.textContent = `‚ùå ERROR ${response.status}:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    output.textContent = `‚úÖ SUCCESS:\n\nAvailable models:\n${data.models?.map(m => '- ' + m.name).join('\n') || 'No models found'}\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                output.textContent = `‚ùå FETCH ERROR: ${error.message}`;
            }
        }
        
        async function testModel(version, modelName) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('Please enter API key');
                return;
            }
            
            const outputId = version === 'v1' && modelName === 'gemini-pro' ? 'output3' : 'output4';
            const output = document.getElementById(outputId);
            output.textContent = 'Testing...';
            
            try {
                const url = `https://generativelanguage.googleapis.com/${version}/models/${modelName}:generateContent?key=${apiKey}`;
                console.log('Testing:', url);
                
                const requestBody = {
                    contents: [{
                        parts: [{
                            text: 'Say hello in JSON format: {"message": "your message"}'
                        }]
                    }]
                };
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    output.textContent = `‚ùå ERROR ${response.status}:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No text';
                    output.textContent = `‚úÖ SUCCESS!\n\nModel: ${modelName}\nResponse: ${text}\n\nFull:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                output.textContent = `‚ùå FETCH ERROR: ${error.message}`;
            }
        }
    </script>
</body>
</html>
